‚úÖ POS SUITE ‚Äî EXECUTION PROMPT (PHASE 3A)

üîê Authority & Context

You are executing Phase 3A ‚Äî POS Suite Implementation of the WebWaka Modular Rebuild.

All governance, registry, CI/CD, and core services are COMPLETE and LOCKED:
	‚Ä¢	Module Registry exists and is enforced
	‚Ä¢	Core services implemented and stable:
	‚Ä¢	webwaka-core-identity
	‚Ä¢	webwaka-core-permissions
	‚Ä¢	webwaka-core-audit
	‚Ä¢	webwaka-core-receipts
	‚Ä¢	webwaka-core-payments
	‚Ä¢	CI/CD is active
	‚Ä¢	Vercel Preview + Production deployments are live
	‚Ä¢	Demo mode is NOT ALLOWED
	‚Ä¢	Mobile-first, Offline-first, PWA-first is MANDATORY

You must not change any core service or registry behavior.

‚∏ª

üß† Implementation Platform (MANDATORY)
	‚Ä¢	Platform: Replit
	‚Ä¢	Account: Replit-01
	‚Ä¢	Repository: webwaka-suite-pos
	‚Ä¢	GitHub Org: ChangerPlanet
	‚Ä¢	Deployment Target: Vercel project already linked
	‚Ä¢	Branching:
	‚Ä¢	Feature branches only
	‚Ä¢	PR ‚Üí Preview
	‚Ä¢	Merge ‚Üí Production

‚∏ª

üß± OSS-FIRST REQUIREMENT (NON-NEGOTIABLE)

You must use the approved OSS stack for POS wherever applicable.

‚úÖ Approved POS OSS Stack (LOCKED)

Capability	OSS Tool	Notes
POS UI foundation	Vendure Admin UI patterns	UI inspiration only, not backend
Offline-first storage	Dexie.js (IndexedDB)	‚ùå localStorage is forbidden
PWA	Workbox	Background sync required
State	Zustand	Lightweight, offline-friendly
Forms	React Hook Form	Touch-first UX
Validation	Zod	Must align with core services
QR	qrcode	For receipts
Printing (future-safe)	ESC/POS-compatible abstraction	Interface only

‚ùå You must not invent custom offline systems if OSS exists
‚ùå You must not fork core logic
‚ùå You must not embed payment logic

‚∏ª

üéØ POS SUITE SCOPE (STRICT)

You are building ONLY the POS Suite.

The POS Suite MUST:
	‚Ä¢	Consume core services
	‚Ä¢	Declare its capabilities in module.manifest.json
	‚Ä¢	Be installable/removable via the registry
	‚Ä¢	Work fully offline for cash + transfer
	‚Ä¢	Never bypass permissions or identity
	‚Ä¢	Emit audit events for every sensitive action

‚∏ª

üß© PHASE 3A ‚Äî POS IMPLEMENTATION SCOPE

3A.1 ‚Äî POS Core (Offline-First Sales)

Deliverables
	‚Ä¢	Product search (offline cache)
	‚Ä¢	Cart management
	‚Ä¢	Quantity + price calculation
	‚Ä¢	VAT 7.5% (Nigeria)
	‚Ä¢	‚Ç¶5 / ‚Ç¶10 cash rounding
	‚Ä¢	IndexedDB persistence
	‚Ä¢	Resume after refresh / power loss

Rules
	‚Ä¢	Offline sales must complete with CASH
	‚Ä¢	No payment gateway calls here
	‚Ä¢	Use webwaka-core-identity for session resolution

üõë Stop Condition

A cashier can complete 10 cash sales fully offline, reload the app, reconnect, and all sales sync correctly.

‚∏ª

3A.2 ‚Äî Payments & Receipts Integration

Integrations
	‚Ä¢	webwaka-core-payments
	‚Ä¢	webwaka-core-receipts
	‚Ä¢	webwaka-core-audit

Supported payment methods
	‚Ä¢	CASH (offline allowed)
	‚Ä¢	BANK_TRANSFER (reference + proof upload)
	‚Ä¢	CARD / MOBILE (online-only, blocked offline)

Receipt Handling
	‚Ä¢	Generate receipt via core service
	‚Ä¢	Display QR
	‚Ä¢	No printing yet (interface only)

üõë Stop Condition

A completed sale produces a verifiable receipt with QR, and audit logs confirm payment ‚Üí receipt linkage.

‚∏ª

3A.3 ‚Äî Shifts, Registers & Reconciliation

Features
	‚Ä¢	Open shift (location + float)
	‚Ä¢	Close shift
	‚Ä¢	X Report (mid-shift)
	‚Ä¢	Z Report (end-shift)
	‚Ä¢	Cash reconciliation
	‚Ä¢	Supervisor approval via permissions service

Audit
	‚Ä¢	Every shift action must emit audit events

üõë Stop Condition

A shop can open a shift, sell all day, close the shift, reconcile cash, and produce a Z-report.

‚∏ª

3A.4 ‚Äî Advanced POS Ops

Features
	‚Ä¢	Inventory adjustments (damage, theft, correction)
	‚Ä¢	Cash movements (drawer ‚Üî safe)
	‚Ä¢	Supervisor dashboard (read-only)
	‚Ä¢	Multi-location awareness

Security
	‚Ä¢	Dual-control enforcement
	‚Ä¢	No self-approval
	‚Ä¢	All actions audited

üõë Stop Condition

A supervisor can audit the entire day‚Äôs activity across registers and locations.

‚∏ª

üì¶ Mandatory Files to Update

You must update the following in webwaka-suite-pos:
	‚Ä¢	module.manifest.json
	‚Ä¢	Capabilities (e.g. pos:sale.create)
	‚Ä¢	Dependencies on core modules
	‚Ä¢	module.contract.md
	‚Ä¢	Public interfaces exposed
	‚Ä¢	CHANGELOG.md
	‚Ä¢	Semantic versioning
	‚Ä¢	Tests (‚â•80% coverage)

‚∏ª

üö´ ABSOLUTE PROHIBITIONS

You must NOT:
	‚Ä¢	Modify any core repo
	‚Ä¢	Add demo data or demo bypasses
	‚Ä¢	Use localStorage
	‚Ä¢	Hardcode permissions
	‚Ä¢	Embed payment gateways
	‚Ä¢	Skip audit logging
	‚Ä¢	Bypass tenant isolation

‚∏ª

üì§ Final Output Requirements

When complete, submit:
	1.	Completion Report with:
	‚Ä¢	Features implemented
	‚Ä¢	OSS used (with justification)
	‚Ä¢	Stop conditions verified
	2.	Final commit SHA
	3.	Vercel Preview URL
	4.	Known follow-ups (if any)

‚∏ª

üõë FINAL HARD STOP

Do not proceed to:
	‚Ä¢	SVM
	‚Ä¢	MVM
	‚Ä¢	ParkHub

until Phase 3A POS is explicitly approved.

‚∏ª